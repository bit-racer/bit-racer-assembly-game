

StartChat PROC
       initPort
      

       mov ax, 0003h
        int 10h
       

C_MAIN_LOOP:
            ; Set the cursor position for sender
          
            movCur rec_row, rec_col 
          checkRecive
          JZ C_SEND

          reciveChar
          cmp al, 0dh
          jz C_NEWLINE_C

          inc rec_col

          mov ah, 02h
          mov dl, al
          int 21h

          cmp rec_col, 78
            jz C_NEWLINE_C
            BACK1:
          cmp rec_row, 25
            jz C_SCROLL_C

          jmp C_SEND

C_NEWLINE_C:
          inc rec_row
          mov rec_col, 40
          JMP BACK1
C_SCROLL_C:
          
          mov ah, 06h
          mov al, 1
          mov bh, 0
          mov ch, 0
          mov cl, 40
          mov dh, 24
          mov dl, 79
          mov bh, 07h
          int 10h

          dec rec_row
C_SEND:
        movCur sender_row, sender_col
          checkSend
          JZ C_MAIN_LOOP

          ;; Handle the key
          ChkKey
          JZ C_MAIN_LOOP
          GetKey
          ;cmp al, 0dh
          ;jmp ESCAPE
          cmp ah, 01h
          jz C_EXIT
          sendChar al
          cmp al, 0dh
          jz C_NEWLINE


            ; Print the character
            mov ah, 02h
            mov dl, al
            int 21h

            inc sender_col

            cmp sender_col, 38
            jz C_NEWLINE
C_BACK2:
            cmp sender_row, 25
            jz C_SCROLL        
         
          JMP C_MAIN_LOOP

C_NEWLINE:
          inc sender_row
          mov sender_col, 0
          JMP C_BACK2

C_SCROLL:
          ;ScrollDown 0, 0, 24, 39

          ; Color the screen red
          mov ah, 06h
          mov al, 1
          mov bh, 0
          mov ch, 0
          mov cl, 0
          mov dh, 24
          mov dl, 39
          mov bh, 07h
          int 10h
          dec sender_row
          JMP C_MAIN_LOOP
C_EXIT:
  SetVideoMode


ret 
StartChat ENDP